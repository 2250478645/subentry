# 动手实现一个vue的双向绑定

先上图，参考链接[https://segmentfault.com/a/1190000006599500](https://segmentfault.com/a/1190000006599500)

![vue](vue.png)

## 思路

可以分为三个步骤

- 输入框以及文本节点与 data 中的数据绑定
- 输入框内容变化时，data 中的数据同步变化，这步实现了 view => model
- data 中的数据变化时，文本节点的内容同步变化，实现 model => view

### 数据绑定

通过 `documentFragment` 将挂载目标的所有子节点进行「劫持」，经过统一处理之后再整体插入挂载目标

将「劫持」到的 dom 对象就行遍历，将有 `v-model` 属性名的元素和被 `{}` 包裹的文本提取出来赋值给 Vue 「实例对象」 的  `data` 对象中

### V=>M

如果 `input` 框上 `v-model` 属性，那么会调用其 `change` 方法，实时更新 `data` ，在「实例对象」的 `data` 对象中创建的值会用 `defineProperty`对其 `set` 和 `get` 进行改写,在此步骤中 `set` 只需要更新属性的值。

### M=>V

使用订阅发布模式「观察者模式」，发布者发布通知 => 主题对象「包含所有订阅者」收到通知推送给订阅者=>订阅者执行相应操作

因此，`data` 中每有一个属性被创建，相应也会创建其主题对象 `dep` , 在处理「劫持」到的 html 时，每当与 `data` 中的属性绑定会在其对应的 `dep` 对象中添加一个订阅者 `watcher`,其中需要通过 `Dep` 定义一个全局的 `target` 属性暂存新建的 `watcher` ，添加后移除。 `watcher` 触发实例对象的 `get` 方法从而将 `Dep.target` 存储进去

